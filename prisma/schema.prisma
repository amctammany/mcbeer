// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider   = "prisma-client"
  engineType = "client"

  output = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum StyleCategory {
  beer
  mead
  cider
}

model Style {
  id Int @id @default(autoincrement())

  userId String?
  // owner         User?         @relation(fields: [userId], references: [id])

  name String

  slug String @unique
  //recipes       Recipe[]

  category StyleCategory

  subcategoryId Int

  identifier String @unique

  overall String?

  aroma String?

  appearance String?

  flavor String?

  mouthfeel String?

  comments String?

  history String?

  ingredients String?

  comparison String?

  examples String?

  ibuLow Float?

  ibuHigh Float?

  ibuFlex Boolean @default(false)

  ogLow Float?

  ogHigh Float?

  ogFlex Boolean @default(false)

  fgLow Float?

  fgHigh Float?

  fgFlex Boolean @default(false)

  srmLow Float?

  srmHigh Float?

  srmFlex Boolean @default(false)

  abvLow Float?

  abvHigh Float?

  abvFlex Boolean @default(false)
}

enum UserRoles {
  SUPERUSER
  ADMIN
  USER
}

model UserPreferences {
  id Int @id @default(autoincrement())

  userId String @unique

  theme String @default("system") // Options: light, dark, system

  language String @default("en") // ISO language code, e.g., en, es, fr

  timezone String? // e.g., America/New_York

  fontSize String @default("medium") // Options: small, medium, large

  massSystem MassSystem @default(US)

  color UserColorPreference @default(L)

  flow FlowUnit @default(gpm)

  concentration ConcentrationUnit @default(ppm)

  time TimeUnit @default(min)

  percent PercentUnit @default(percent)

  volume UserVolumePreference @default(gal)

  mass UserMassPreference @default(LbOz)

  hopMass UserMassPreference @default(Oz)

  fermentableMass UserMassPreference @default(Lb)

  gravity UserGravityPreference @default(SG)

  temperature UserTemperaturePreference @default(F)

  pressure UserPressurePreference @default(PSI)

  createdAt DateTime @default(now())

  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum MassSystem {
  US
  Imperial
  Metric
}

enum MassUnit {
  Oz
  Lb
  g
  Kg
}

enum FlowUnit {
  gpm
  lpm
}

enum ConcentrationUnit {
  ppm
  ppb
}

enum TimeUnit {
  min
  hr
  days
}

enum PercentUnit {
  percent
  percentage
}

enum UserVolumePreference {
  L
  gal
  bbl
}

enum UserMassPreference {
  g
  LbOz
  Lb
  Oz
  Kg
}

enum UserPressurePreference {
  PSI
  kPa
  bar
}

enum UserEnergyPreference {
  kJ
  kcal
}

enum UserTemperaturePreference {
  F
  C
}

enum UserGravityPreference {
  SG
  Brix
  Plato
  nD
  GCM3
}

enum UserColorPreference {
  L
  EBC
  SRM
}

model User {
  id              String           @id
  name            String
  email           String
  emailVerified   Boolean          @default(false)
  image           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  username        String?
  sessions        Session[]
  accounts        Account[]
  UserPreferences UserPreferences?

  role                 UserRoles?            @default(USER)
  displayUsername      String?
  equipmentProfiles    EquipmentProfile[]
  waterProfiles        WaterProfile[]
  mashProfiles         MashProfile[]
  fermentationProfiles FermentationProfile[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

enum MashSpargeWaterCalculations {
  Default
  BatchSparge
  NoSparge
  IgnoreExpansion
}

model EquipmentProfile {
  id                     String                      @id @default(cuid())
  name                   String
  slug                   String                      @unique
  description            String?
  batchVolume            Float?
  boilVolume             Float?
  preboilVolume          Float?
  boilTime               Float?
  brewEfficiency         Float?
  mashEfficiency         Float?
  boilOffRate            Float?
  trubLoss               Float?                      @default(0)
  mashLoss               Float?                      @default(0)
  fermenterLoss          Float?                      @default(0)
  grainAbsorption        Float?                      @default(0.5)
  waterGrainRatio        Float?                      @default(1.5)
  mashTunVolume          Float?                      @default(100)
  mashTunWeight          Float?                      @default(100)
  mashTunSpecificHeat    Float?                      @default(0.12)
  mashTunDeadSpace       Float?                      @default(0)
  waterCalculationMethod MashSpargeWaterCalculations @default(Default)
  boilExpansion          Float?                      @default(0.04)
  fermenterTopOff        Float?                      @default(0)
  forkedFrom             String?
  origin                 EquipmentProfile?           @relation("origin", fields: [forkedFrom], references: [id])
  forks                  EquipmentProfile[]          @relation("origin")
  userId                 String?
  owner                  User?                       @relation(fields: [userId], references: [id])
  //  Recipe          Recipe[]
  //  UserPreferences UserPreferences[]
}

model WaterProfile {
  id          String         @id @default(cuid())
  userId      String?
  owner       User?          @relation(fields: [userId], references: [id])
  name        String
  slug        String         @unique
  calcium     Int?           @default(0)
  magnesium   Int?           @default(0)
  sodium      Int?           @default(0)
  chloride    Int?           @default(0)
  sulfate     Int?           @default(0)
  bicarbonate Int?           @default(0)
  description String?
  //  Recipe         Recipe[]
  //  DefaultSources UserPreferences[] @relation("SourceWater")
  //  TargetSources  UserPreferences[] @relation("TargetWater")
  forkedFrom  String?
  origin      WaterProfile?  @relation("origin", fields: [forkedFrom], references: [id])
  forks       WaterProfile[] @relation("origin")
}

model MashProfile {
  id               String        @id @default(cuid())
  name             String
  slug             String        @unique
  spargeTemp       Float         @default(168)
  grainTemp        Float         @default(72)
  grainWeightBasis Float?        @default(10)
  mashPh           Float?        @default(5.4)
  mashTunTemp      Float         @default(72)
  description      String?
  userId           String?
  forkedFrom       String?
  origin           MashProfile?  @relation("origin", fields: [forkedFrom], references: [id])
  forks            MashProfile[] @relation("origin")

  steps MashStep[]
  owner User?      @relation(fields: [userId], references: [id])
}

enum MashStepType {
  temperature
  infusion
  decoction
}

model MashStep {
  id          Int           @id @default(autoincrement())
  type        MashStepType? @default(temperature)
  name        String?
  temperature Int
  time        Int
  rampTime    Int?          @default(0)
  index       Int

  MashProfile   MashProfile @relation(fields: [mashProfileId], references: [id], onDelete: Cascade)
  mashProfileId String

  @@unique(name: "mashIndex", fields: [mashProfileId, index])
}

model FermentationProfile {
  id          String                @id @default(cuid())
  name        String
  slug        String                @unique
  description String?
  steps       FermentationStep[]
  userId      String?
  owner       User?                 @relation(fields: [userId], references: [id])
  forkedFrom  String?
  origin      FermentationProfile?  @relation("origin", fields: [forkedFrom], references: [id])
  forks       FermentationProfile[] @relation("origin")
  //  Recipe          Recipe[]
}

enum FermentationStepType {
  primary
  secondary
  tertiary
  coldcrash
  conditioning
}

model FermentationStep {
  id                    Int                  @id @default(autoincrement())
  type                  FermentationStepType @default(primary)
  name                  String?
  index                 Int
  temperature           Float
  time                  Float
  rampTime              Float                @default(0)
  FermentationProfile   FermentationProfile  @relation(fields: [fermentationProfileId], references: [id])
  fermentationProfileId String
  //@@unique([mashProfileId, rank])

  @@unique(name: "fermentationIndex", fields: [fermentationProfileId, index])
}
